<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cucumber.market.api.mapper.item.ItemMapper">

    <insert id="insertItem" useGeneratedKeys="true" keyProperty="itemDto.itemId">
        insert into item (member_id, item_name, item_info, price, post_date, view_count)
        values (#{memberId}, #{itemDto.itemName}, #{itemDto.itemInfo} ,#{itemDto.price}, NOW(), 0)
    </insert>

    <select id="selectItem" resultType="resultMap">
        select *
        from item
        where item_id = #{itemId}
    </select>

    <update id="updateViewCount">
        update item
        set view_count = view_count + 1
        where item_id = #{itemId}
    </update>

    <update id="updateItem">
        update item
        set item_name = #{itemDto.itemName},
        item_info = #{itemDto.itemInfo},
        update_date = NOW(),
        price = #{itemDto.price}
        where item_id = #{itemId}
    </update>

    <update id="updateItemStatus">
        update item
        set item_status_id = #{itemStatus}
        where item_id = #{itemId}
    </update>

    <select id="selectItems" resultType="resultMap">
        select *
        from item
        <where>
            <if test="itemName != null and itemName != ''">
                item_name like concat('%',#{itemName},'%')
            </if>
            <if test="itemStatus != null">
                and item_status_id = #{itemStatus}
            </if>
        </where>
    </select>

    <delete id="deleteItem">
        delete from item
        where item_id = #{itemId}
    </delete>

    <insert id="insertLike">
        insert into favorite (item_id, member_id)
        values (#{itemId}, #{memberId})
    </insert>

    <delete id="deleteLike">
        delete from favorite
        where item_id = #{itemId}
        and member_id = #{memberId}
    </delete>

    <insert id="insertBuyerReview">
        insert into buyer_review (item_id, member_id, review)
        values (#{itemId}, #{memberId}, #{reviewDto.review})
    </insert>

    <update id="updateBuyerReview">
        update buyer_review
        set review = #{reviewDto.review}
        where item_id = #{itemId}
    </update>

    <insert id="insertSellerReview">
        insert into seller_review (item_id, review)
        values (#{itemId}, #{reviewDto.review})
    </insert>

    <select id="selectBuyerReview" resultType="resultMap">
        select *
        from buyer_review
        where item_id = #{itemId}
    </select>

    <delete id="deleteBuyerReview">
        delete from buyer_review
        where item_id = #{item_id}
    </delete>
</mapper>